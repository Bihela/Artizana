
> artizana-backend@1.0.0 test
> jest tests/unit/googleAuth.test.js

  console.log
    GOOGLE_CLIENT_ID loaded: YES

      at Object.log (src/config/passport.js:5:9)

  console.error
    Google Web Auth Error: secretOrPrivateKey must have a value

      191 |     });
      192 |   } catch (err) {
    > 193 |     console.error('Google Web Auth Error:', err.message);
          |             ^
      194 |     res.status(401).json({ error: 'Invalid Google token or auth failed' });
      195 |   }
      196 | });

      at error (src/routes/auth.js:193:13)

  console.error
    Google Web Auth Error: secretOrPrivateKey must have a value

      191 |     });
      192 |   } catch (err) {
    > 193 |     console.error('Google Web Auth Error:', err.message);
          |             ^
      194 |     res.status(401).json({ error: 'Invalid Google token or auth failed' });
      195 |   }
      196 | });

      at error (src/routes/auth.js:193:13)

FAIL tests/unit/googleAuth.test.js
  POST /google-web
    ✓ should return 400 if no token provided (30 ms)
    ✕ should create a new user and return token when valid google token provided (11 ms)
    ✕ should login existing user and return token (3 ms)

  ● POST /google-web › should create a new user and return token when valid google token provided

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      66 |         const res = await request(app).post('/google-web').send({ idToken: 'valid_token' });
      67 |
    > 68 |         expect(res.statusCode).toBe(200);
         |                                ^
      69 |         expect(res.body.token).toBeDefined();
      70 |         expect(res.body.user.email).toBe('newuser@example.com');
      71 |         expect(res.body.user.role).toBeNull();

      at Object.toBe (tests/unit/googleAuth.test.js:68:32)

  ● POST /google-web › should login existing user and return token

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

       97 |         const res = await request(app).post('/google-web').send({ idToken: 'valid_token_existing' });
       98 |
    >  99 |         expect(res.statusCode).toBe(200);
          |                                ^
      100 |         expect(res.body.token).toBeDefined();
      101 |         expect(res.body.user.email).toBe('existing@example.com');
      102 |         expect(res.body.user.role).toBe('Buyer');

      at Object.toBe (tests/unit/googleAuth.test.js:99:32)

--------------|---------|----------|---------|---------|------------------------------------------
File          | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                        
--------------|---------|----------|---------|---------|------------------------------------------
All files     |   36.97 |    17.85 |      10 |   38.73 |                                          
 config       |   33.33 |     12.5 |       0 |   36.36 |                                          
  passport.js |   33.33 |     12.5 |       0 |   36.36 | 13-32,37-38                              
 models       |      50 |        0 |       0 |   54.54 |                                          
  User.js     |      50 |        0 |       0 |   54.54 | 14-17,21-22                              
 routes       |   36.14 |    21.42 |      20 |   37.17 |                                          
  auth.js     |   36.14 |    21.42 |      20 |   37.17 | 17-53,63-104,121-132,159-161,181,200-235 
--------------|---------|----------|---------|---------|------------------------------------------
Test Suites: 1 failed, 1 total
Tests:       2 failed, 1 passed, 3 total
Snapshots:   0 total
Time:        0.545 s, estimated 1 s
Ran all test suites matching tests/unit/googleAuth.test.js.
